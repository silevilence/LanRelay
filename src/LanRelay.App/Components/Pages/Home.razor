@page "/"

<div class="home-container">
    <div class="sidebar">
        <DeviceList SelectedDeviceId="@selectedDeviceId"
                    OnDeviceSelected="HandleDeviceSelected" />
    </div>
    <div class="main-content">
        <ChatWindow SelectedDevice="@selectedDevice"
                    IsConnected="@isConnected"
                    OnSendMessage="HandleSendMessage" />
    </div>
</div>

@code {
    [Inject]
    private ChatState ChatState { get; set; } = default!;

    private Guid? selectedDeviceId;
    private DeviceInfo? selectedDevice;
    private bool isConnected = false;

    private void HandleDeviceSelected(DeviceInfo device)
    {
        selectedDeviceId = device.DeviceId;
        selectedDevice = device;
        ChatState.SelectDevice(device.DeviceId);

        // TODO: Establish TCP connection to the selected device
        // For now, simulate connection
        isConnected = true;
    }

    private async Task HandleSendMessage(string text)
    {
        if (selectedDevice is null)
            return;

        // TODO: Actually send via TcpMessageClient
        // For now, the message is already added to ChatState in ChatWindow
        await Task.CompletedTask;
    }
}
