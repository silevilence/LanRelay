# 局域网中转传输软件 - 需求规格说明书 (V1.0)

**版本号**：1.0
**日期**：2026-01-28
**状态**：已确认

---

## 1. 引言

### 1.1 项目背景
在复杂的局域网办公或家庭环境中，常存在物理隔离或多网段并存的情况（如内网/外网隔离，或不同部门的子网）。现有的局域网传输工具多局限于单一广播域，无法跨网段通信。本软件旨在提供一种无需互联网、去中心化、支持双网卡中转的即时通讯与文件传输解决方案。

### 1.2 产品范围
本软件（V1.0）主要运行于 Windows 平台，核心功能包括：局域网设备发现、跨网段中继传输、动态组网、即时消息与文件传输。

---

## 2. 总体描述

### 2.1 用户特征
*   **普通用户**：需要快速给同事发送文件，不关心网络拓扑。
*   **中继用户**：拥有双网卡设备（连接两个网段），愿意作为桥梁协助他人传输。

### 2.2 运行环境
*   **操作系统**：Windows 10 / 11 及以上版本。
*   **网络环境**：支持 IPv4 局域网，需防火墙放行指定端口。

### 2.3 关键假设
*   软件采用单实例运行模式（禁止多开）。
*   V1.0 版本数据传输采用明文（依赖局域网物理安全性）。

---

## 3. 功能需求 (Functional Requirements)

### 3.1 身份与网络发现
*   **REQ-3.1.1 唯一标识**：软件启动时，若用户未设置昵称，自动生成随机昵称。系统必须生成一个全局唯一的 UUID 作为设备标识，确保即使昵称重复也能准确寻址。
*   **REQ-3.1.2 多网卡扫描**：软件需监听本机所有网络接口（NIC），通过 UDP 广播发现同一网段内的其他在线设备。
*   **REQ-3.1.3 在线列表**：实时展示扫描到的设备列表，包含昵称、IP地址（脱敏或简略显示）及网络距离（直连/需中转）。

### 3.2 动态组网与中转 (核心)
*   **REQ-3.2.1 创建群组**：
    *   用户可创建群组，**组名必填**。
    *   **入组密码**：选填。若设置，加入时需校验。
*   **REQ-3.2.2 加入群组与发现**：
    *   用户可扫描并申请加入现有群组。
    *   **跨网段可见性**：若设备 A（网段1）和设备 C（网段2）均加入由设备 B（双网卡）创建或所在的群组，A 应在列表中看到 C，状态标记为“通过 B 中转”。
*   **REQ-3.2.3 中转逻辑**：
    *   **权限控制**：默认开启中转功能，用户可在设置中手动关闭。
    *   **透明传输**：当 B 协助 A 向 C 传输数据时：
        *   B 的 UI 需显示“正在中转：A -> C”的状态及流量速度。
        *   B **不得**将传输的文件内容保存至硬盘（仅允许内存缓冲或临时流转发，传输结束即释放）。
    *   **生命周期**：若中继节点 B 退出或掉线，A 与 C 的连接中断，软件需提示“链路断开”，不要求自动寻找替代路径。

### 3.3 消息与文件传输
*   **REQ-3.3.1 消息类型**：
    *   支持文本消息（支持 Emoji）。
    *   支持图片、视频（作为文件传输，但 UI 可显示缩略图）。
    *   支持任意格式的文件传输（V1.0 仅支持文件，不支持文件夹结构）。
*   **REQ-3.3.2 发送模式**：
    *   **点对点**：选择列表中的设备直接发送。
    *   **群组广播**：在组内发送，所有在线成员均可接收。
*   **REQ-3.3.3 接收控制**：
    *   提供“自动接收”开关（默认关闭）。
    *   关闭状态下，收到文件请求需弹出确认框（同意/拒绝/另存为）。
    *   支持设置默认下载目录。
*   **REQ-3.3.4 会话记录**：
    *   **即阅即焚**：软件关闭后，内存中的所有聊天记录和图片缓存必须清空，不留存任何历史记录文件。

### 3.4 系统交互与通知
*   **REQ-3.4.1 托盘驻留**：
    *   点击关闭按钮最小化至系统托盘。
    *   托盘图标需根据状态（在线、传输中、有未读消息）切换不同图标或角标。
*   **REQ-3.4.2 消息通知**：
    *   当收到消息或文件请求时，若主窗口未激活，需弹出系统级通知（Toast）。

### 3.5 日志管理
*   **REQ-3.5.1 操作日志**：需记录启动、停止、建组、入组、发送文件（文件名/大小/目标）、接收文件、中转任务（源/目标/流量）等操作。
*   **REQ-3.5.2 存储策略**：日志保存为本地 `.log` 文件，通过文件大小或日期进行滚动删除（Rolling Retention），防止磁盘占满。

---

## 4. 技术约束与架构选型 (Technical Constraints)

为确保高性能网络吞吐及开发效率，项目需严格遵循以下技术栈：

### 4.1 开发技术栈
*   **开发语言**：C#
*   **运行时框架**：**.NET 10 (LTS)**
*   **UI 框架**：**MAUI Blazor Hybrid**
    *   利用 Blazor (HTML/CSS) 构建聊天气泡、列表及进度条等高频交互界面。
    *   利用 MAUI 容器处理窗口管理、系统托盘及原生 API 调用。
*   **IDE 支持**：VS Code (配合 C# Dev Kit)。

### 4.2 架构模式
*   **UI 设计模式**：**状态容器模式 (State Container Pattern)**。
    *   禁止使用传统的复杂 MVVM (INotifyPropertyChanged)。
    *   必须通过单例 State 类管理应用状态（如 `DeviceListState`, `TransferProgressState`）。
    *   UI 组件通过 C# 事件订阅 State 变化并调用 `StateHasChanged` 更新界面。

### 4.3 网络协议
*   **传输层**：**TCP**（用于控制信令及文件数据流，确保可靠性）。
*   **发现层**：**UDP**（用于局域网广播发现）。

---

## 5. 质量属性 (Quality Attributes)

*   **性能**：中转传输时，中继节点的额外 CPU 占用率不应超过 10%（基于千兆网络满速测试）。
*   **稳定性**：在连续传输 10GB 以上大文件时无内存泄漏。
*   **易用性**：零配置启动，软件打开即自动完成扫描。

---

## 6. 未来规划 (Roadmap)

以下功能已列入后续版本规划，V1.0 不予实现：
*   Android / iOS 移动端适配。
*   文件夹结构传输。
*   断点续传与传输暂停。
*   传输内容端到端加密 (E2EE)。
*   无组模式下的多跳自动路由发现。
